<!DOCTYPE html>
<html lang="en">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="A pure Ruby client for Apache Cassandra">
    <meta name="author" content="DataStax">

    <title>Ruby Driver for Apache Cassandra - SSL encryption</title>

    <link rel="icon" href="../../../../favicon.ico">
    <link rel="apple-touch-icon" href="../../../../favicon.png">
    <link href="../../../../css/style.css" rel="stylesheet">
    <link href="../../../../css/pygments.css" rel="stylesheet">
    <link href="../../../../css/hotkeys.css" rel="stylesheet">

    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body ng-app="docs" data-spy="scroll" data-target=".side-nav">
    <header class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../../../">Ruby Driver for Apache Cassandra</a>
        </div>
        <div class="collapse navbar-collapse" ng-controller="search">
          <ul class="nav navbar-nav">
            
            <li>
              <a href="../../../">Introduction</a>
            </li>
            
            <li class="active">
              <a href="../../">Features</a>
            </li>
            
            <li>
              <a href="../../../api/">API docs</a>
            </li>
            
          </ul>
          <form class="navbar-form form-search navbar-right dropdown visible-lg-block" ng-class="{open: hasResults}" role="search" ng-submit="submit()">
            <div class="form-group has-feedback">
              <input type="search" class="form-control input-sm mousetrap" placeholder="Search..." ng-model="q" ng-change="search('v1.0.0-rc.1')" ng-disabled="!searchReady" disabled data-hotkey="{down: moveDown, up: moveUp, esc: reset}" data-search>
            </div>
            <ul class="dropdown-menu" role="menu">
              <li ng-repeat="result in results" ng-class="{'bg-warning': $index == current}"><a ng-href="{{basePath}}{{result.path}}"><span ng-bind-html="summary(result)"></span></a></li>
            </ul>
          </form>
        </div>
      </div>
    </header>

    <div class="container" id="content">
      <div class="row">
        <div class="col-md-9 content">
          <nav class="crumbs">
            <ol class="breadcrumb">
              
              <li>
                <div class="dropdown">
                  <button id="current-version" class="btn btn-default btn-sm" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    v1.0.0-rc.1
                    <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu" role="menu" aria-labelledby="current-version">
                  
                    <li><a href="../../../../features/security/ssl_encryption/">v2.0.1</a></li>
                  
                    <li><a href="../../../../v2.0.0/features/security/ssl_encryption/">v2.0.0</a></li>
                  
                    <li><a href="../../../../v1.2.0/features/security/ssl_encryption/">v1.2.0</a></li>
                  
                    <li><a href="../../../../v1.1.1/features/security/ssl_encryption/">v1.1.1</a></li>
                  
                    <li><a href="../../../../v1.1.0/features/security/ssl_encryption/">v1.1.0</a></li>
                  
                    <li><a href="../../../../v1.0.0/features/security/ssl_encryption/">v1.0.0</a></li>
                  
                    <li class="disabled"><a href="./">v1.0.0-rc.1</a></li>
                  
                    <li><a href="../../../../v1.0.0-beta.3/features/security/ssl_encryption/">v1.0.0-beta.3</a></li>
                  
                    <li><a href="../../../../v1.0.0-beta.2/features/security/ssl_encryption/">v1.0.0-beta.2</a></li>
                  
                    <li><a href="../../../../v1.0.0-beta.1/">v1.0.0-beta.1</a></li>
                  
                  </ul>
                </div>
              </li>
              
              
              
              
              <li><a href="../../../">Introduction</a></li>
              
              
              
              
              
              <li><a href="../../">Usage</a></li>
              
              
              
              
              
              <li><a href="../">Security</a></li>
              
              
              
              
              
              <li class="active">SSL encryption</li>
              
              
              
            </ol>
          </nav>
          
<div class="feature-section">
<h1 id="ssl-encryption">SSL encryption<a class="anchor" href="#ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h1>
<p>There are a few levels of security that SSL encryption can provide when
communicating with Apache Cassandra. You can find them below in the
increasing security order: the first being the least secure and the last -
the most.</p>

<ol>
<li>Using default SSL context. This method is actually not secure as there is
no peer validation happening. <code>Cassandra.cluster(ssl: true)</code>
</li>
<li>Using shared certificate authority. This method is more secure than the
previous one, because the client is able to validate the identity of the
server. Using this method the server can’t trust the client unless
additional authentication has been provided.
<code>Cassandra.cluster(server_cert: '/path/to/ca.pem')</code>
</li>
<li>Using trusted client certificates. This method, in addition to peer
verification, allows server to validate identities of the clients. Make
sure to enable <code>client_encryption_options.require_client_auth</code> setting in
<code>cassandra.yaml</code>, as well as add all trusted client keys to Apache
Cassandra’s truststore. You can use server certificate as well as client
certificate and private key with an optional passphrase to connect to
Apache Cassandra. <code>Cassandra.cluster(server_cert: '/path/to/ca.pem', client_cert: '/path/to/client.pem', private_key: '/path/to/client.key', passphrase:  'secret passphrase for private key')</code>
</li>
</ol>
<h2 id="using-default-ssl-encryption">Using default SSL encryption<a class="anchor" href="#using-default-ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="kp">true</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
<h2 id="connection-fails-when-not-using-ssl-encryption">Connection fails when not using SSL encryption<a class="anchor" href="#connection-fails-when-not-using-ssl-encryption" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">connect_timeout: </span><span class="mi">2</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection failed
</code></pre>
</dd>
</dl>
<h2 id="using-an-ssl-certificate-authority">Using an SSL certificate authority<a class="anchor" href="#using-an-ssl-certificate-authority" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">server_cert: </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'SERVER_CERT'</span><span class="p">])</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed with a valid ca path in the environment</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
<h2 id="using-ssl-authentication">Using SSL authentication<a class="anchor" href="#using-ssl-authentication" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL client authentication enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code><span class="nb">require</span> <span class="s1">'cassandra'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span>
    <span class="ss">server_cert:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'SERVER_CERT'</span><span class="p">],</span>
    <span class="ss">client_cert:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'CLIENT_CERT'</span><span class="p">],</span>
    <span class="ss">private_key:  </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PRIVATE_KEY'</span><span class="p">],</span>
    <span class="ss">passphrase:   </span><span class="no">ENV</span><span class="p">[</span><span class="s1">'PASSPHRASE'</span><span class="p">]</span>
  <span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed with ca and cert path and key in the environment</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
<h2 id="using-a-custom-ssl-context">Using a custom SSL context<a class="anchor" href="#using-a-custom-ssl-context" aria-hidden="true"><span class="glyphicon glyphicon-link"></span></a>
</h2>
<dl class="steps">
<dt>Given </dt>
<dd>a running cassandra cluster with SSL encryption enabled</dd>
<dt>And </dt>
<dd>the following example:<pre class="highlight"><code><span class="nb">require</span> <span class="s1">'cassandra'</span>
<span class="nb">require</span> <span class="s1">'openssl'</span>

<span class="k">begin</span>
  <span class="n">cluster</span> <span class="o">=</span> <span class="no">Cassandra</span><span class="p">.</span><span class="nf">cluster</span><span class="p">(</span><span class="ss">ssl: </span><span class="no">OpenSSL</span><span class="o">::</span><span class="no">SSL</span><span class="o">::</span><span class="no">SSLContext</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"connection successful"</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">: </span><span class="si">#{</span><span class="n">e</span><span class="p">.</span><span class="nf">message</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"connection failed"</span>
<span class="k">else</span>
  <span class="n">cluster</span><span class="p">.</span><span class="nf">close</span>
<span class="k">end</span>
</code></pre>
</dd>
<dt>When </dt>
<dd>it is executed</dd>
<dt>Then </dt>
<dd>its output should contain:<pre><code>connection successful
</code></pre>
</dd>
</dl>
</div>

        </div>
        <div class="col-md-3">
          <div id="navigation" class="panel-group side-nav" data-spy="affix" data-offset-top="60" data-offset-bottom="54" role="tablist" aria-multiselectable="true">
            <div class="panel panel-default">
              <div id="table-of-contents-heading" class="panel-heading" role="tab">
                <h4 class="panel-title">
                  <a data-toggle="collapse" data-parent="#navigation" href="#table-of-contents" aria-expanded="true" aria-controls="table-of-contents">Contents</a>
                </h4>
              </div>
              <div id="table-of-contents" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="table-of-contents-heading">
                <div class="panel-body">
                  <ol class="nav nav-pills nav-stacked toc">
<li><a href="#using-default-ssl-encryption">Using default SSL encryption
</a></li>
<li><a href="#connection-fails-when-not-using-ssl-encryption">Connection fails when not using SSL encryption
</a></li>
<li><a href="#using-an-ssl-certificate-authority">Using an SSL certificate authority
</a></li>
<li><a href="#using-ssl-authentication">Using SSL authentication
</a></li>
<li><a href="#using-a-custom-ssl-context">Using a custom SSL context
</a></li>
</ol>
                </div>
              </div>
            </div>

            
          </div>
        </div>
      </div>
    </div>

    
    <footer class="container text-muted">
      <ul class="list-inline">
      
        
        <li>
          <a href="https://github.com/datastax/ruby-driver/">Code</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="http://datastax.github.io/ruby-driver/">Docs</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://datastax-oss.atlassian.net/browse/RUBY/">Issues</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://groups.google.com/a/lists.datastax.com/forum/#!forum/ruby-driver-user">Mailing List</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="irc://irc.freenode.net/datastax-drivers">IRC Channel</a>
        </li>
      
        <li>·</li>
        <li>
          <a href="https://github.com/datastax/ruby-driver/releases">Releases</a>
        </li>
      
      </ul>
    </footer>
    

    <script src="../../../../js/jquery.js"></script>
    <script src="../../../../js/bootstrap.js"></script>
    <script src="../../../../js/angular.js"></script>
    <script src="../../../../js/mousetrap.js"></script>
    <script src="../../../../js/hotkeys.js"></script>
    <script src="../../../../js/ZeroClipboard.js"></script>
    <script src="../../../../js/lunr.js"></script>
    <script src="../../../../js/app.js"></script>
  </body>
</html>
